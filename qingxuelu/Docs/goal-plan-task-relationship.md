# 目标、计划、任务关系设计文档

## 📋 概述

本文档详细描述了学习目标（Goal）、学习计划（Plan）、学习任务（Task）三者之间的关系，以及用户可以在不同页面进行的关联操作。

## 🏗️ 数据层次结构

```
学习目标 (LearningGoal)
    ↓ (一对多)
学习计划 (LearningPlan) 
    ↓ (一对多)
周计划 (WeeklyPlan)
    ↓ (一对多)
学习任务 (LearningTask)
    ↓ (一对多)
学习记录 (LearningRecord)
```

## 🔗 关系定义

### 1. 目标 (LearningGoal)
**定义**: 用户设定的长期学习目标，如"掌握Python编程"、"通过英语四级考试"

**核心属性**:
- `id`: 唯一标识
- `title`: 目标标题
- `description`: 目标描述
- `category`: 学科分类
- `priority`: 优先级
- `startDate`: 开始日期
- `targetDate`: 目标完成日期
- `progress`: 完成进度 (0.0-1.0)
- `milestones`: 里程碑列表
- `keyResults`: 关键结果列表

**关联关系**:
- 一对多关联学习计划 (`planId`)
- 一对多关联学习任务 (`goalId`)

### 2. 计划 (LearningPlan)
**定义**: 为实现目标而制定的系统性学习计划，通常由AI生成

**核心属性**:
- `id`: 唯一标识
- `goalId`: 关联的目标ID
- `title`: 计划标题
- `description`: 计划描述
- `totalWeeks`: 总周数
- `startDate`: 开始日期
- `endDate`: 结束日期
- `status`: 计划状态
- `weeklyPlans`: 周计划列表

**关联关系**:
- 多对一关联学习目标 (`goalId`)
- 一对多关联周计划 (`planId`)
- 一对多关联学习任务 (`planId`)

### 3. 任务 (LearningTask)
**定义**: 具体的学习任务，是计划的最小执行单元

**核心属性**:
- `id`: 唯一标识
- `title`: 任务标题
- `description`: 任务描述
- `category`: 学科分类
- `priority`: 优先级
- `status`: 任务状态
- `taskType`: 任务类型
- `estimatedDuration`: 预估时长
- `actualDuration`: 实际时长
- `scheduledStartTime`: 计划开始时间
- `scheduledEndTime`: 计划结束时间
- `dueDate`: 截止日期
- `goalId`: 关联的目标ID (可选)
- `planId`: 关联的计划ID (可选)
- `weeklyPlanId`: 关联的周计划ID (可选)

**任务类型**:
- `manual`: 手动创建
- `planGenerated`: 计划生成
- `goalRelated`: 目标相关
- `recurring`: 重复任务

**关联关系**:
- 多对一关联学习目标 (`goalId`, 可选)
- 多对一关联学习计划 (`planId`, 可选)
- 多对一关联周计划 (`weeklyPlanId`, 可选)

## 📱 页面关联操作

### 1. 目标页面 (GoalsView)

**功能**: 管理学习目标

**可进行的关联操作**:

#### A. 目标 → 计划
- **操作**: 点击目标卡片 → "生成学习计划"
- **页面**: `CreatePlanView` 或 `AIPlanningView`
- **流程**: 
  1. 选择目标模板或自定义目标
  2. AI根据目标生成学习计划
  3. 计划自动关联到目标 (`planId = goal.id`)

#### B. 目标 → 任务
- **操作**: 点击目标卡片 → "添加任务"
- **页面**: `AddTaskView`
- **流程**:
  1. 创建新任务
  2. 自动关联到目标 (`goalId = goal.id`)
  3. 任务类型设为 `goalRelated`

**显示信息**:
- 目标基本信息
- 关联的计划列表
- 关联的任务列表
- 整体进度统计

### 2. 计划页面 (PlanView)

**功能**: 管理学习计划

**可进行的关联操作**:

#### A. 计划 → 目标
- **操作**: 查看计划详情
- **页面**: 计划详情视图
- **显示**: 关联的目标信息 (`goalId`)

#### B. 计划 → 任务
- **操作**: 点击周计划 → "查看任务" 或 "添加任务"
- **页面**: `TimelineTaskView` 或 `AddTaskView`
- **流程**:
  1. 查看计划生成的任务
  2. 手动添加补充任务
  3. 任务自动关联到计划 (`planId = plan.id`)

**显示信息**:
- 计划基本信息
- 周计划时间线
- 每周的任务安排
- 计划执行进度

### 3. 今日页面 (TodayView)

**功能**: 管理今日任务

**可进行的关联操作**:

#### A. 任务 → 目标
- **操作**: 点击任务卡片 → "关联目标"
- **页面**: 目标选择器
- **流程**:
  1. 选择现有目标
  2. 更新任务关联 (`goalId = selectedGoal.id`)
  3. 任务类型更新为 `goalRelated`

#### B. 任务 → 计划
- **操作**: 点击任务卡片 → "关联计划"
- **页面**: 计划选择器
- **流程**:
  1. 选择现有计划
  2. 更新任务关联 (`planId = selectedPlan.id`)
  3. 任务类型更新为 `planGenerated`

#### C. 创建独立任务
- **操作**: 点击"添加任务"
- **页面**: `AddTaskView`
- **流程**:
  1. 创建新任务
  2. 可选择关联目标或计划
  3. 任务类型设为 `manual`

**显示信息**:
- 今日任务时间线
- 任务状态和进度
- 关联的目标/计划信息

### 4. 任务页面 (TasksView)

**功能**: 管理所有任务

**可进行的关联操作**:

#### A. 任务 → 目标
- **操作**: 任务列表 → 选择任务 → "编辑" → "关联目标"
- **页面**: `AddTaskView` (编辑模式)
- **流程**:
  1. 编辑任务信息
  2. 选择关联目标
  3. 保存更新

#### B. 任务 → 计划
- **操作**: 任务列表 → 选择任务 → "编辑" → "关联计划"
- **页面**: `AddTaskView` (编辑模式)
- **流程**:
  1. 编辑任务信息
  2. 选择关联计划
  3. 保存更新

#### C. 批量关联
- **操作**: 选择多个任务 → "批量操作" → "关联到目标/计划"
- **页面**: 批量操作界面
- **流程**:
  1. 选择多个任务
  2. 选择目标或计划
  3. 批量更新关联关系

**显示信息**:
- 所有任务列表
- 任务状态筛选
- 关联关系显示
- 任务统计信息

## 🔄 关联操作流程

### 1. 目标驱动流程
```
创建目标 → AI生成计划 → 计划分解为周计划 → 周计划生成任务 → 任务显示在时间线
```

**数据流**:
1. `Goal` 创建
2. `Plan` 创建，`plan.goalId = goal.id`
3. `WeeklyPlan` 创建，`weeklyPlan.planId = plan.id`
4. `Task` 创建，`task.planId = plan.id`, `task.goalId = goal.id`

### 2. 手动任务流程
```
手动创建任务 → 可选择关联目标/计划 → 任务独立存在或关联
```

**数据流**:
1. `Task` 创建，`taskType = .manual`
2. 可选：设置 `task.goalId` 或 `task.planId`
3. 任务保存到系统

### 3. 重复任务流程
```
创建重复任务 → 设置重复模式 → 系统自动生成重复实例
```

**数据流**:
1. `Task` 创建，`taskType = .recurring`
2. 设置 `recurringPattern`
3. 系统根据模式生成重复实例

## 📊 关联状态管理

### 1. 关联完整性检查
- **目标完整性**: 检查目标是否有关联的计划和任务
- **计划完整性**: 检查计划是否有关联的目标和任务
- **任务完整性**: 检查任务是否可以独立存在或需要关联

### 2. 关联更新策略
- **级联更新**: 目标删除时，相关计划和任务的处理策略
- **关联验证**: 确保关联关系的有效性
- **数据一致性**: 维护关联数据的一致性

### 3. 关联显示规则
- **优先级显示**: 任务关联多个对象时的显示优先级
- **状态同步**: 关联对象状态变化时的同步更新
- **进度计算**: 基于关联关系计算整体进度

## 🎯 最佳实践

### 1. 用户操作建议
- **新用户**: 建议先创建目标，再生成计划，最后执行任务
- **灵活用户**: 可以直接创建任务，后续再关联目标或计划
- **系统用户**: 利用AI生成功能，快速建立完整的学习体系

### 2. 数据管理建议
- **定期清理**: 删除无效的关联关系
- **数据备份**: 重要关联关系的备份策略
- **性能优化**: 大量关联数据的分页和缓存策略

### 3. 功能扩展建议
- **智能推荐**: 基于关联关系推荐相关任务
- **进度预测**: 基于历史数据预测目标完成时间
- **关联分析**: 分析任务完成情况对目标的影响

## 📝 总结

目标、计划、任务三者形成了完整的学习管理体系：

- **目标**提供方向和动力
- **计划**提供系统性和结构
- **任务**提供具体的执行单元

通过灵活的关联机制，用户可以：
1. 从目标出发，系统化地规划学习
2. 从任务出发，灵活地管理日常学习
3. 在任意页面进行两两关联操作
4. 根据学习进度调整关联关系

这种设计既保证了系统的完整性，又提供了足够的灵活性，满足不同用户的学习管理需求。
